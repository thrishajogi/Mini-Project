<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Log in to ZeroBank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>/* same styles as before, omitted for brevity — keep your existing styles */ *{margin:0;padding:0;box-sizing:border-box} body{font-family: Arial, Helvetica, sans-serif; font-size:14px; color:#333; background:#f5f5f5; line-height:1.5; height:100vh; display:flex; justify-content:center; align-items:flex-start; padding-top:50px;} .box{width:360px; background:#fff; padding:30px; border-radius:6px; box-shadow:0 0 8px rgba(0,0,0,.1);} h2{text-align:center;margin-bottom:22px;font-size:24px} label{display:block;margin-bottom:6px;font-weight:600} input[type=text],input[type=password]{width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;font-size:14px;} .chk{margin:12px 0;font-size:13px} .chk input{margin-right:6px} button{width:100%;padding:11px;margin-top:10px;background:#0066d1;color:#fff;border:none;border-radius:4px;font-size:16px;cursor:pointer;} button:hover{background:#0050aa} .foot{text-align:center;margin-top:12px;font-size:12px} .foot a{color:#0066d1;text-decoration:none} .foot a:hover{text-decoration:underline} .alert-error{display:none;background:#fdecea;color:#7b1d1d;padding:10px;border-radius:4px;font-size:13px;margin-bottom:12px;text-align:center;} .hint{font-size:13px;color:#666;margin-top:8px;text-align:center}</style>
</head>
<body>
  <div class="box">
    <h2>Log in to ZeroBank</h2>
    <div id="errorBox" class="alert-error"></div>

    <label for="email">Email</label>
    <input id="email" type="text" placeholder="Enter email">

    <label for="password">Password</label>
    <input id="password" type="password" placeholder="Enter password">

    <div class="chk">
      <label><input type="checkbox" id="keepSigned"> Keep me signed in</label>
    </div>

    <button id="loginBtn">Log in</button>

    <div class="foot">
      <a href="forgot-password.html">Forgot your password ?</a>
    </div>

    <p class="hint" id="mfaHint" style="display:none"></p>
  </div>

  <script>
    const API_BASE = 'http://localhost:5000';
    const $ = id => document.getElementById(id);
    function showError(msg) { const el = $('errorBox'); el.textContent = msg; el.style.display = 'block'; }
    function hideError() { $('errorBox').style.display = 'none'; }

    async function handleLogin() {
      hideError();
      const email = $('email').value.trim();
      const password = $('password').value;
      const keep = $('keepSigned').checked;
      if (!email || !password) return showError('Please fill both email and password.');

      const btn = $('loginBtn');
      btn.disabled = true;

      try {
        const res = await fetch(`${API_BASE}/login`, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ email, password })
        });

        let data = null;
        try { data = await res.json(); } catch(e) { data = null; }

        if (!res.ok) {
          // Surface server error if any
          if (data && (data.error || data.message)) {
            if (data.remainingSec) {
              const s = data.remainingSec;
              if (s >= 3600) showError(`${data.error||data.message} Try again in ${Math.ceil(s/3600)} hour(s).`);
              else if (s >= 60) showError(`${data.error||data.message} Try again in ${Math.ceil(s/60)} minute(s).`);
              else showError(`${data.error||data.message} Try again in ${s} second(s).`);
            } else showError(data.error || data.message);
          } else {
            showError('Login failed. Check credentials or server status.');
          }
          btn.disabled = false;
          return;
        }

        // *** FORCED FLOW: ALWAYS go to security-login.html after password success ***
        sessionStorage.setItem('pendingEmail', email.toLowerCase());
        $('mfaHint').textContent = 'Password accepted — redirecting to security verification...';
        $('mfaHint').style.display = 'block';
        setTimeout(()=> window.location.href = 'security-login.html', 300);
      } catch (err) {
        console.error('login error', err);
        showError('Network error. Ensure backend is running on port 5000.');
        btn.disabled = false;
      }
    }

    $('loginBtn').addEventListener('click', handleLogin);
    document.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleLogin(); });
  </script>
</body>
</html>
